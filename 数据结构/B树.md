# B 树

标签（空格分隔）： 数据结构

---

[toc]

## B-树

> B-树，也称为B树，是一颗多路平衡搜索树（可对比[平衡二叉查找树](二叉树.md)），适合单值查找。

### 相关概念

- 阶数：一个结点最多包含子结点个数（一般用字母m表示）
- 关键字：结点上的数值
- 度：一个结点拥有的子结点个数

### m阶B-树主要特征

- 根结点至少有两个子女
- 非根结点关键值个数范围：`⌈m/2⌉ < k < m` (`⌈⌉`表示向上取整)
- 有k个关键字的非叶结点恰好有k+1个孩子
- 所有的叶子结点都位于同一层

### 优点

- 每个结点都包含关键字及数据，由于关键字可能离根节点更近，访问更迅速。
- 树的高度（IO次数）更低，减少了IO访问次数。（共同优点）

## B+树

> B+树是B-树的变体，也是一颗多路搜索树。

### m阶B+树主要特征

- 每个结点至多有m个子女
- 非根结点关键值个数范围：`⌈m/2⌉ < k <= m` (`⌈⌉`表示向上取整)
- 有k个关键字的非叶子几点恰好有k个孩子
- 相邻叶子结点通过指针相连，并且按关键字大小排序

### 优点

- 所有的叶子结点使用链表相连，**便于区间查找和遍历**。B树则需要进行每一层的递归遍历。相邻的元素可能在内存中不相邻，所以缓存命中性没有B+树好。
- B+树的中间结点不保存数据，能容纳更多结点元素。
- 树的高度（IO次数）更低，减少了IO访问次数。（共同优点）

### 插入

1. B+树插入都是在叶子结点进行的，就是插入前，需要先找到要插入的叶子结点。
2. 如果被插入关键字的叶子结点，当前含有的关键字数量是小于阶数m，则直接插入。
3. 如果插入关键字后，叶子结点当前含有的关键字数目等于阶数m，则该结点开始**分裂**为两个新的结点，一个结点包含`⌊m/2⌋` 个关键字，另外一个关键字包含`⌈m/2⌉`个关键值。（`⌊⌋`表示向下取整，`⌈⌉`表示向上取整，如`⌈3/2⌉=2`）。
4. 分裂后，需要将第⌈m/2⌉的关键字上移到父结点。如果这时候父结点中包含的关键字个数小于m，则插入操作完成。
5. 分裂后，需要将⌈m/2⌉的关键字上移到父结点。如果父结点中包含的关键字个数等于m，则继续分裂父结点。

### 删除

- 找到包含关键值的结点，如果关键字个数大于⌈m/2⌉-1，直接删除即可；
- 找到包含关键值的结点，如果关键字个数大于⌈m/2⌉-1，并且关键值是当前结点的最大（小）值，并且该关键值存在父子结点中，那么删除该关键字，同时需要相应调整父结点的值。
- 找到包含关键值的结点，如果删除该关键字后，关键字个数小于⌈m/2⌉，并且其兄弟结点有多余的关键字，则从其兄弟结点借用关键字
- 找到包含关键值的结点，如果删除该关键字后，关键字个数小于⌈m/2⌉，并且其兄弟结点没有多余的关键字，则与兄弟结点合并。

## B+树和B-树的主要区别

|对比|B-|B+|
|---|---|---|
|非叶子结点是否保存数据|是|否，仅做索引|
|相邻叶子结点关系|无|使用链表指针相连|
|关键字查找|找到既停止|通过索引查找，找到叶子结点才会停止|
|关键字出现次数|仅出现在一个结点中|可出现在多个结点中|

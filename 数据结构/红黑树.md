# 红黑树

标签（空格分隔）： 数据结构

---

[toc]

## 概述
> 是一颗特殊的，含有红黑结点并能**自平衡**的二叉查找树。
> 通过“2-3-4树”（相当于4阶B树）演变而成。黑色结点与其子结点组成类似B树的超级结点。

## 特性

1. 结点是黑色或者红色
1. 根结点必是黑色
1. 每个叶子结点（NIL）是黑色
1. 每个红色结点的两个子结点一定都是黑色
1. **任意结点到所有叶子结点的路径中包含相同数量的黑色结点**
1. 红黑树新插入的结点起始设定为红色

## **自平衡方法**

### 左旋
> 以某个结点作为支点(旋转结点)，其右子结点变为旋转结点的父结点，右子结点的左子结点变为旋转结点的右子结点，左子结点保持不变。

### 右旋
> 以某个结点作为支点(旋转结点)，其左子结点变为旋转结点的父结点，左子结点的右子结点变为旋转结点的左子结点，右子结点保持不变。

### 变色
> 结点的颜色由红变黑或由黑变红。

## 结点操作

### 查找
> 同二叉查找树。

### 插入
> 查找插入的位置，插入后自平衡。

1. 将红黑树当作一颗二叉查找树，将结点插入。
2. 将插入的结点着色为"红色"。（"红色"不破坏特性五）
3. 通过一系列的旋转或着色等操作，使之重新成为一颗红黑树。

#### 插入的结点是根结点
> 说明是一颗空树，直接把此结点涂为黑色。

#### 插入的结点的父结点是黑色
> 插入后，无需自平衡。

#### 插入的结点Key已存在
> 不改变结构，仅更新值即可。

#### **插入的结点的父结点是红色**

- 左左结点旋转（父结点是左结点，当前结点是左结点）
    > 叔叔结点是黑色，且当前结点是其父结点的左孩子
    1. 将“父结点”设为“黑色”
    1. 将“祖父结点”设为“红色”
    1. 将“祖父结点”右旋
    
    ```
    ## 插入结点65，父结点66是红色
    
            B69                          
            / \
           /   \                            R66                               B66
         R66   NIL                         /   \                             /   \
         / \         祖父结点69右旋       /     \            变色            /     \
        /   \       -------------->     R65     B69        ------>        R65     R69
      R65   NIL                         / \     / \	                      / \     / \
      / \                              /   \   /   \                     /   \   /   \
     /   \                           NIl  NIL NIL  NIL                 NIl  NIL NIL  NIL
    NIL  NIL
    
    ## 对比2-3-4树，插入效果
    
        | 66 69 |  --->  | 65 66 69 |
       
    // 插入后，形成超级结点`65 66 69`。中间结点相当于红黑树黑色结点，两边结点相当于红黑树红色结点。
    ```
    


- 左右结点旋转（父结点是左结点，当前结点是右结点）
    > 叔叔结点是黑色，且当前结点是其父结点的右孩子
    1. 将“父结点”左旋
    2. 操作同“左左结点旋转”

    ```
    ## 插入结点67，父结点66是红色
    
            B69                                     B69                   
            / \                                     / \
           /   \                                   /   \                                                   
         R66   NIL                               R67   NIL                   
         / \             父结点66左旋            / \  
        /   \           -------------->         /   \   
       NIL   R67                              R66   NIL  
             / \                              / \       
            /   \                            /   \          
           NIL  NIL                        NIL   NIL
    
    ```
    
- 右右结点旋转（父结点是右结点，当前结点是右结点）
    > 叔叔结点是黑色，且当前结点是其父结点的右孩子。
    > 操作同“左左结点旋转”反向操作。

- 右左结点旋转（父结点是右结点，当前结点是左结点）
    > 叔叔结点是黑色，且当前结点是其父结点的左孩子。
    > 操作同“左右结点旋转”反向操作。

- **变色**
    > 叔叔结点是红色

### 删除
> 查找目标结点，删除后自平衡。

1. 将红黑树当作一颗二叉查找树，将结点删除。
2. 通过"旋转和重新着色"等一系列来修正该树，使之重新成为一棵红黑树。

#### 待删除结点的子结点至少有一个为NIL结点

1. 删除后，使用有值子结点替代位置。
2. 如果子结点都为NIL，则将当前结点设置为NIL。
3. 按需进行自平衡处理

#### 待删除结点的子结点都是非NIL结点

1. 找到该结点的前驱或后继
    - 前驱：左子树中值最大的结点。
    - 后继：右子树中值最小的结点。
1. 将前驱或者后继结点的值复制到该结点上
1. 删除前驱或者后继
# linux 用户组

---

[toc]

## 概述

> Linux 是多用户多任务操作系统，换句话说，Linux 系统支持多个用户在同一时间内登陆，不同用户可以执行不同的任务，并且互不影响。
> 通过对用户分组，可统一对组内用户进行管理及控制访问权限。

### 用户ID和组ID

> Linux 系统中，每个用户的 `ID` 细分为 2 种，分别是**用户 ID（User ID，简称 UID）**和**组 ID（Group ID，简称 GID）**，这与文件有拥有者和拥有群组两种属性相对应。

- 查看用户的`UID`和`GID`：`id <用户名>`

### 用户和组的关系

- **一对一**：一个用户可以存在一个组中，是组中的唯一成员；
- **一对多**：一个用户可以存在多个用户组中，此用户具有这多个组的共同权限；
- **多对一**：多个用户可以存在一个组中，这些用户具有和组相同的权限；
- **多对多**：多个用户可以存在多个组中，也就是以上 3 种关系的扩展。

## 用户操作

### 添加用户

> 选项可为空，则使用响应的默认值创建用户。

```bash
[root@localhost ~]#useradd [选项] 用户名

选项：
    -u <UID>：指定用户的 UID，注意 UID 的范围（不要小于 500）。
    -d <主目录>：指定用户的主目录。主目录必须写绝对路径，而且如果需要指定主目录，则一定要注意权限；
    -c <用户说明>：指定 `/etc/passwd` 文件中用户信息第 5 个字段的描述性内容，可随意配置；
    -g <组名>：指定用户的初始组。一般以和用户名相同的组作为用户的初始组，在创建用户时会默认建立初始组。一旦手动指定，则系统将不会在创建此默认的初始组目录。
    -G <组名>：指定用户的附加组。把用户加入其他组，一般都使用附加组；
    -s <shell>：指定用户的登录 `Shell`，默认是 `/bin/bash`；
    -e <曰期>：指定用户的失效曰期，格式为 "YYYY-MM-DD"。也就是 `/etc/shadow` 文件的第八个字段；
    -o：允许创建的用户的 UID 相同。例如，执行 "useradd -u 0 -o usertest" 命令建立用户 usertest，它的 UID 和 root 用户的 UID 相同，都是 0；
    -m：建立用户时强制建立用户的家目录。在建立系统用户时，该选项是默认的；
    -r：创建系统用户，也就是 UID 在 `1~499` 之间，供系统程序使用的用户。由于系统用户主要用于运行系统所需服务的权限配置，因此系统用户的创建默认不会创建主目录。
```

### 修改用户密码

```bash
[root@localhost ~]#passwd [选项] 用户名

选项：
    -S：查询用户密码的状态，也就是 `/etc/shadow`文件中此用户密码的内容。仅 root 用户可用；
    -l：暂时锁定用户，该选项会在 `/etc/shadow` 文件中指定用户的加密密码串前添加 "!"，使密码失效。仅 root 用户可用；
    -u：解锁用户，和 -l 选项相对应，也是只能 root 用户使用；
    --stdin：可以将通过管道符输出的数据作为用户的密码。主要在批量添加用户时使用；
    -n 天数：设置该用户修改密码后，多长时间不能再次修改密码，也就是修改 `/etc/shadow` 文件中各行密码的第 4 个字段；
    -x 天数：设置该用户的密码有效期，对应 `/etc/shadow` 文件中各行密码的第 5 个字段；
    -w 天数：设置用户密码过期前的警告天数，对应 `/etc/shadow` 文件中各行密码的第 6 个字段；
    -i 日期：设置用户密码失效日期，对应 `/etc/shadow` 文件中各行密码的第 7 个字段。
```

### 修改用户信息

```bash
[root@localhost ~]#usermod [选项] 用户名

选项：
    -c <用户说明>：修改用户的说明信息，即修改 `/etc/passwd` 文件目标用户信息的第 5 个字段；
    -d <主目录>：修改用户的主目录，即修改 `/etc/passwd` 文件中目标用户信息的第 6 个字段，需要注意的是，主目录必须写绝对路径；
    -e <日期>：修改用户的失效曰期，格式为 "YYYY-MM-DD"，即修改 /etc/shadow 文件目标用户密码信息的第 8 个字段；
    -g <组名>：修改用户的初始组，即修改 `/etc/passwd` 文件目标用户信息的第 4 个字段（GID）；
    -u <UID>：修改用户的UID，即修改 `/etc/passwd` 文件目标用户信息的第 3 个字段（UID）；
    -G <组名>：修改用户的附加组，其实就是把用户加入其他用户组，即修改 `/etc/group` 文件；
    -l <用户名>：修改用户名称；
    -L：临时锁定用户（Lock）；
    -U：解锁用户（Unlock），和 -L 对应；
    -s <shell>：修改用户的登录 `Shell`，默认是 `/bin/bash`。
```

### 删除用户

> 从以下文件中，删除与指定用户有关的数据信息。

- 用户基本信息：存储在 `/etc/passwd` 文件中；
- 用户密码信息：存储在 `/etc/shadow` 文件中；
- 用户群组基本信息：存储在 `/etc/group` 文件中；
- 用户群组密码信息：存储在 `/etc/gshadow` 文件中；
- 用户个人文件：主目录默认位于 `/home/用户名`，邮箱位于 `/var/spool/mail/用户名`。

```bash
[root@localhost ~]# userdel -r 用户名

选项：
    -r ：表示在删除用户的同时删除用户的家目录。
```

### 切换用户身份

```bash
[root@localhost ~]# su [选项] 用户名

选项：
    -：当前用户不仅切换为指定用户的身份，同时所用的工作环境也切换为此用户的环境（包括 PATH 变量、MAIL 变量等），使用 - 选项可省略用户名，默认会切换为 root 用户。
    -l：同 - 的使用类似，也就是在切换用户身份的同时，完整切换工作环境，但后面需要添加欲切换的使用者账号。
    -p：表示切换为指定用户的身份，但不改变当前的工作环境（不使用切换用户的配置文件）。
    -m：和 -p 一样；
    -c 命令：仅切换用户执行一次命令，执行后自动切换回来，该选项后通常会带有要执行的命令。
```

### `whoami` 与 `who am i` 命令

- `whoami`，用来打印当前执行操作的用户名。
- `who am i`，用来打印登陆当前 Linux 系统的用户名。

## 用户组操作

### 添加用户组

```bash
[root@localhost ~]# groupadd [选项] 组名

选项：
    -g GID：指定组 ID
    -r：创建系统群组
```

### 修改用户组

```bash
[root@localhost ~]# groupmod [选现] 组名

选项：
    -g GID：修改组 ID
    -n 新组名：修改组名
```

### 删除用户组

```bash
[root@localhost ~]# groupdel 组名
```

### 组管理命令 `gpasswd`

> 用于将一个用户添加到组或者从组中删除。

```bash
[root@localhost ~]# gpasswd 选项 组名

选项：
    -a <user>：添加用户到组
    -d <user>：从组删除用户
    -A <user>：指定管理员
    -M <user>：指定组成员和-A的用途差不多
    -r：移除群组的密码，仅 root 用户可用
    -R：让群组的密码失效，仅 root 用户可用。
```

### 切换用户有效组

> 从用户的附加组中选择一个群组，作为用户新的初始组。

```bash
[root@localhost ~]# newgrp 组名
```

# java 引用类型

标签（空格分隔）： java

---

[toc]

## 强引用
> 用来描述**必不可少**的的对象。
> 只要引用存在，垃圾回收器永远不会回收。

```
Object object = new Object();
```
obj对象对后面`new Object`的一个强引用，只有当obj这个引用被释放之后，对象才会被释放掉，这也是我们经常所用到的编码形式。

## 软引用
> 用来描述一些**有用但并不是必需**的对象。
> 只有在内存不足的时候JVM才会回收该对象。

```
Object obj = new Object();
SoftReference<Object> sf = new SoftReference<Object>(obj);
obj = null;
// 有时候会返回null
sf.get();
```
sf是对obj的一个软引用，通过sf.get()方法可以取到这个对象，当然，当这个对象被标记为需要回收的对象时，则返回null；
软引用主要用户实现类似缓存的功能，在内存足够的情况下直接通过软引用取值，无需从繁忙的真实来源查询数据，提升速度；当内存不足时，自动删除这部分缓存数据，从真正的来源查询这些数据。

## 弱引用
> 也是用来描述**非必需**对象的
> 第二次垃圾回收时回收

### 弱引用与软引用的区别
> 只具有弱引用的对象拥有更短暂的生命周期。
> 在垃圾回收器线程扫描它所管辖的内存区域的过程中，一旦发现了只具有弱引用的对象，不管当前内存空间足够与否，都会回收它的内存。
> 不过，由于垃圾回收器是一个优先级很低的线程，因此不一定会很快发现那些只具有弱引用的对象。所以被软引用关联的对象只有在内存不足时才会被回收，而被弱引用关联的对象在JVM进行垃圾回收时总会被回收。

```
Object obj = new Object();
WeakReference<Object> wf = new WeakReference<Object>(obj);
obj = null;
//有时候会返回null
wf.get();
//返回是否被垃圾回收器标记为即将回收的垃圾
wf.isEnQueued();
```

## 虚引用
> 虚引用和前面的软引用、弱引用不同，它并不影响对象的生命周期。
> 如果一个对象与虚引用关联，则跟没有引用与之关联一样，在任何时候都可能被垃圾回收器回收。
> 虚引用主要用来跟踪对象被垃圾回收的活动。

```
Object obj = new Object();
PhantomReference<Object> pf = new PhantomReference<Object>(obj);
obj=null;
// 永远返回null
pf.get();
// 返回是否从内存中已经删除
pf.isEnQueued();
```
虚引用主要用于检测对象是否已经从内存中删除。

## 总结

|引用类型|	被回收时间|	用途|	生存时间|
|---
|强引用|	从来不会|	对象的一般状态|	JVM停止运行时|
|软引用|	内存不足时|	对象缓存|	内存不足时|
|弱引用|    jvm垃圾回收时|	对象缓存|	gc运行后|
|虚引用|	未知|	未知|	未知|





# 事务介绍

标签：mysql

---

## 概述

由一系列对系统数据的操作所组成的一个程序执行逻辑单元。

### 普通事务与XA事务区别

- 普通事务
只支持一个数据库连接,不能跨越多个数据库。默认的情况为自动提交事务，也就是说，每一条对数据库的更新的sql语句代表一项事务，操作成功后，系统自动调用`commit`来提交，否则将调用`rollback`来撤消事务。

- XA事务
支持在两个或多个网络计算机资源上访问并且更新数据，这些数据可以分布在多个数据库上。

### 事务特性

- 原子性（`Atomicity`）
    事务中包含的所有操作要么全部成功，要么全部失败回滚。
- 一致性（`Consistency`）
    事务执行前和执行后必须处于一致性状态。
- 隔离性（`Isolation`）
    当多个用户并发访问数据库时，数据库为每一个用户开启的事务，不被其他事务的操作所干扰，多个并发事务之间要相互隔离。
- 持久性（`Durability`）
    一个事务一旦被提交了，那么对数据库中的数据的改变就是永久性的，即便在数据库系统遇到故障的情况下也不会丢失事物的操作。
    
### 并发问题

- 脏读（`Dirty Read`）
    一个事务处理过程里读取了另一个**未提交**的事务中的数据。
- 不可重复读（`Unrepeatable Read`）
    A事务读取了B事务**已提交**的更改（修改、删除）数据，导致两次读取该数据的结果不一致。
    对于不可重复读问题，可使用行锁解决。
- 幻读（`Phantom Read`）
    A事务读取B事务**已提交**的新增数据，导致两次读取该数据的结果不一致。
    对于幻读问题，可使用读写锁解决。

### 事务隔离级别

隔离级别越高，执行效率越低。

- 读未提交（`READ_UNCOMMITTED`）
    最低级别，任何情况都会发生。
- 读已提交（`READ_COMMITED`）
    可避免脏读。
- 可重复读（`REPEATABLE_READ`）
    可避免脏读、不可重复读。
- 顺序读/串行化（`SERIALIZABLE`）
    最高隔离级别，可避免脏读、不可重复读、幻读。

MySQL默认隔离级别：可重复读。
Oracle默认隔离级别：读已提交。仅支持`SERIALIZABLE`、`READ_COMMITED`。

## java 事务类型

- JDBC 事务
- JTA（Java Transaction API）事务
- 容器事务

## 名词解释

|名称|描述|
|:---:|:---:|
|`XA`|由`X/Open`组织提出的分布式事务的规范。|


